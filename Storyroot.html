<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Storyroot - Your Story Vault</title>
    <link rel="icon" href="data:image/svg+xml,<svg xmlns=%22http://www.w3.org/2000/svg%22 viewBox=%220 0 100 100%22><text y=%22.9em%22 font-size=%2290%22>üå≥</text></svg>">
    <link rel="stylesheet" href="Storyroot.css">
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/dompurify@3.0.6/dist/purify.min.js"></script>
</head>
<body>
    <!-- Toast Notification -->
    <div id="toast"></div>

    <!-- Main Layout -->
    <div class="app-container">
        <!-- Left Sidebar - File Explorer -->
        <aside class="sidebar left-sidebar" id="leftSidebar">
            <div class="sidebar-header">
                <h2>üå≥ Storyroot</h2>
                <button class="icon-btn" onclick="toggleLeftSidebar()" title="Toggle Sidebar">‚óÄ</button>
            </div>

            <div class="sidebar-actions">
                <button class="action-btn" onclick="createNewNote()" title="New Note">
                    <span class="btn-icon">üìù</span>
                    <span class="btn-label">New Note</span>
                </button>
                <button class="action-btn" onclick="createNewFolder()" title="New Folder">
                    <span class="btn-icon">üìÅ</span>
                    <span class="btn-label">New Folder</span>
                </button>
            </div>

            <!-- Search Box -->
            <div class="search-container">
                <input type="text" id="searchInput" placeholder="üîç Search notes..." oninput="searchNotes()">
            </div>

            <!-- File Explorer -->
            <div class="file-explorer" id="fileExplorer">
                <!-- Populated by JavaScript -->
            </div>

            <!-- Sidebar Footer -->
            <div class="sidebar-footer">
                <button onclick="openSettingsModal()">‚öôÔ∏è Settings</button>
                <button onclick="exportVault()">üíæ Export</button>
            </div>
        </aside>

        <!-- Main Editor Area -->
        <main class="main-content">
            <!-- Top Bar -->
            <div class="editor-header">
                <button class="icon-btn" onclick="toggleLeftSidebar()" id="menuToggle">‚ò∞</button>
                <div class="breadcrumb" id="breadcrumb">
                    <span class="breadcrumb-item">No note selected</span>
                </div>
                <div class="editor-actions">
                    <button class="icon-btn" onclick="toggleEditMode()" id="modeToggle" title="Toggle Edit/Preview">
                        üëÅÔ∏è
                    </button>
                    <button class="icon-btn" onclick="toggleRightSidebar()" title="Toggle Backlinks">
                        ‚ñ∂
                    </button>
                </div>
            </div>

            <!-- Editor Tabs -->
            <div class="editor-tabs">
                <button class="tab-btn active" onclick="switchEditorTab('edit')">‚úèÔ∏è Edit</button>
                <button class="tab-btn" onclick="switchEditorTab('preview')">üëÅÔ∏è Preview</button>
                <button class="tab-btn" onclick="switchEditorTab('split')">‚ö° Split</button>
            </div>

            <!-- Editor Container -->
            <div class="editor-container" id="editorContainer">
                <!-- Formatting Toolbar -->
                <div class="formatting-toolbar" id="formattingToolbar">
                    <button class="toolbar-btn" onclick="insertFormatting('bold')" title="Bold (Ctrl+B)">
                        <strong>B</strong>
                    </button>
                    <button class="toolbar-btn" onclick="insertFormatting('italic')" title="Italic (Ctrl+I)">
                        <em>I</em>
                    </button>
                    <button class="toolbar-btn" onclick="insertFormatting('strikethrough')" title="Strikethrough">
                        <s>S</s>
                    </button>
                    <div class="toolbar-separator"></div>
                    <button class="toolbar-btn" onclick="insertFormatting('h1')" title="Heading 1">H1</button>
                    <button class="toolbar-btn" onclick="insertFormatting('h2')" title="Heading 2">H2</button>
                    <button class="toolbar-btn" onclick="insertFormatting('h3')" title="Heading 3">H3</button>
                    <div class="toolbar-separator"></div>
                    <button class="toolbar-btn" onclick="insertFormatting('link')" title="Insert Link (Ctrl+K)">üîó</button>
                    <button class="toolbar-btn" onclick="insertFormatting('wikilink')" title="Insert Wiki Link [[]]">[[]]</button>
                    <button class="toolbar-btn" onclick="insertFormatting('code')" title="Inline Code">`code`</button>
                    <button class="toolbar-btn" onclick="insertFormatting('codeblock')" title="Code Block">```</button>
                    <div class="toolbar-separator"></div>
                    <button class="toolbar-btn" onclick="insertFormatting('quote')" title="Blockquote">‚ùù</button>
                    <button class="toolbar-btn" onclick="insertFormatting('ul')" title="Bullet List">‚Ä¢ List</button>
                    <button class="toolbar-btn" onclick="insertFormatting('ol')" title="Numbered List">1. List</button>
                    <button class="toolbar-btn" onclick="insertFormatting('task')" title="Task List">‚òê Task</button>
                    <div class="toolbar-separator"></div>
                    <button class="toolbar-btn" onclick="insertFormatting('hr')" title="Horizontal Rule">‚Äï</button>
                    <button class="toolbar-btn" onclick="insertFormatting('table')" title="Insert Table">‚äû Table</button>
                </div>

                <!-- Edit Mode -->
                <div class="editor-pane" id="editPane">
                    <textarea id="markdownEditor" placeholder="Start typing... Use [[Note Name]] to link notes and #tag for tags"></textarea>
                </div>

                <!-- Preview Mode -->
                <div class="preview-pane" id="previewPane" style="display:none;">
                    <div id="markdownPreview" class="markdown-preview"></div>
                </div>
            </div>

            <!-- Empty State -->
            <div class="empty-state" id="emptyState">
                <div class="empty-icon">üå≥</div>
                <h2>Welcome to Storyroot</h2>
                <p>Create a new note to get started, or select one from the sidebar.</p>
                <button class="primary-btn" onclick="createNewNote()">Create Your First Note</button>
            </div>
        </main>

        <!-- Right Sidebar - Backlinks & Metadata -->
        <aside class="sidebar right-sidebar" id="rightSidebar">
            <div class="sidebar-header">
                <h3>Note Info</h3>
                <button class="icon-btn" onclick="toggleRightSidebar()">‚ñ∂</button>
            </div>

            <!-- Note Metadata -->
            <div class="metadata-section">
                <h4>Metadata</h4>
                <div id="noteMetadata">
                    <div class="meta-item">
                        <span class="meta-label">Created:</span>
                        <span class="meta-value" id="createdDate">-</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Modified:</span>
                        <span class="meta-value" id="modifiedDate">-</span>
                    </div>
                    <div class="meta-item">
                        <span class="meta-label">Words:</span>
                        <span class="meta-value" id="wordCount">0</span>
                    </div>
                </div>
            </div>

            <!-- Tags -->
            <div class="tags-section">
                <h4>Tags</h4>
                <div id="noteTags" class="tags-container">
                    <span class="empty-message">No tags</span>
                </div>
            </div>

            <!-- Outgoing Links -->
            <div class="links-section">
                <h4>Links in this note</h4>
                <div id="outgoingLinks" class="links-container">
                    <span class="empty-message">No links</span>
                </div>
            </div>

            <!-- Backlinks -->
            <div class="backlinks-section">
                <h4>Backlinks</h4>
                <div id="backlinks" class="links-container">
                    <span class="empty-message">No backlinks</span>
                </div>
            </div>
        </aside>
    </div>

    <!-- Settings Modal -->
    <div id="settingsModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>‚öôÔ∏è Settings</h3>
                <button class="close-btn" onclick="closeSettingsModal()">‚úï</button>
            </div>

            <div class="settings-section">
                <h4>Appearance</h4>
                <label>
                    Theme:
                    <select id="themeSelect" onchange="changeTheme()">
                        <option value="light">Light</option>
                        <option value="dark">Dark</option>
                        <option value="obsidian">Obsidian</option>
                        <option value="sepia">Sepia</option>
                    </select>
                </label>
                <label>
                    Editor Font:
                    <select id="fontFamilySelect" onchange="changeFontFamily()">
                        <option value="monospace">Monospace (Default)</option>
                        <option value="sans-serif">Sans Serif</option>
                        <option value="serif">Serif</option>
                        <option value="courier">Courier New</option>
                        <option value="consolas">Consolas</option>
                        <option value="monaco">Monaco</option>
                        <option value="georgia">Georgia</option>
                        <option value="times">Times New Roman</option>
                        <option value="arial">Arial</option>
                        <option value="verdana">Verdana</option>
                        <option value="comic">Comic Sans MS</option>
                    </select>
                </label>
                <label>
                    Font Size:
                    <input type="range" id="fontSizeRange" min="12" max="24" value="16" oninput="changeFontSize()">
                    <span id="fontSizeValue">16px</span>
                </label>
            </div>

            <div class="settings-section">
                <h4>Editor</h4>
                <label class="checkbox-label">
                    <input type="checkbox" id="autoSaveCheckbox" checked onchange="toggleAutoSave()">
                    <span>Auto-save</span>
                </label>
                <label class="checkbox-label">
                    <input type="checkbox" id="vimModeCheckbox" onchange="toggleVimMode()">
                    <span>Vim mode</span>
                </label>
            </div>

            <div class="settings-section">
                <h4>Data Management</h4>
                <button class="secondary-btn" onclick="exportVault()">üíæ Export All Notes</button>
                <label class="file-input-label">
                    <input type="file" id="importFile" accept=".json" onchange="importVault(this.files[0])" style="display:none;">
                    Import Vault
                </label>
                <button class="danger-btn" onclick="clearAllData()">üóëÔ∏è Clear All Data</button>
            </div>

            <div class="modal-buttons">
                <button onclick="closeSettingsModal()" class="primary-btn">Close</button>
            </div>
        </div>
    </div>

    <!-- Rename Modal -->
    <div id="renameModal" class="modal">
        <div class="modal-content small">
            <div class="modal-header">
                <h3>Rename</h3>
                <button class="close-btn" onclick="closeRenameModal()">‚úï</button>
            </div>
            <input type="text" id="renameInput" placeholder="New name">
            <div class="modal-buttons">
                <button onclick="confirmRename()" class="primary-btn" id="renameConfirmBtn">Rename</button>
                <button onclick="closeRenameModal()" class="secondary-btn">Cancel</button>
            </div>
        </div>
    </div>

    <!-- Delete Confirmation Modal -->
    <div id="deleteModal" class="modal">
        <div class="modal-content small">
            <div class="modal-header">
                <h3>‚ö†Ô∏è Confirm Delete</h3>
                <button class="close-btn" onclick="closeDeleteModal()">‚úï</button>
            </div>
            <p id="deleteMessage">Are you sure you want to delete this item?</p>
            <div class="modal-buttons">
                <button onclick="confirmDelete()" class="danger-btn">Delete</button>
                <button onclick="closeDeleteModal()" class="secondary-btn">Cancel</button>
            </div>
        </div>
    </div>

    <script src="Storyroot.js"></script>
</body>
</html>
